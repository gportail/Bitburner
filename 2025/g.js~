import * as cl from "libs/colors.js";
import { moneyFactor } from "libs/constantes.js";

// const moneyFactor = 0.80;

function help(ns) {
  ns.tprintf(`${cl.yellow}Augmente l'argent du serveur.\n`);
  ns.tprintf('usage : run g.js <target?> <option> ');
  ns.tprintf('options :');
  ns.tprintf('  -h          : aide');
  ns.tprintf('  -c <target> : la cible Ã  grow');
  ns.tprintf('  -i          : pas d\'arret');
  ns.tprintf('  -q          : mode silence');
  ns.exit();
}

/** @param {NS} ns */
export async function main(ns) {
  var host = ns.getHostname();

  var params = ns.flags([
    ['h', false], // aide
    ['c', ''],  // cible
    ['i', false], // pas d'arret
    ['q', false], // silencieu si true
  ]);

  if (params['h']) {
    help(ns);

  }

  let quiet = params['q'];

  if (params['c'] != '') host = params['c'];
  if (!quiet) ns.tprintf("%s : Execution du script %s avec %s comme cible.", ns.getHostname(), ns.getScriptName(), host);



  var minMoney = ns.getServerMaxMoney(host) * moneyFactor;

  if (ns.getServerMaxMoney(host) == 0) ns.exit(); // pas d'argent sur ce serveur
  while (true) {
    // si $ present < 80% du max$ => on fait grandir
    if (ns.getServerMoneyAvailable(host) < minMoney) {
      await ns.grow(host, { threads: ns.self.threads });
    } else {
      if (params['i']) {
        await ns.sleep(1000);
        continue;
      }
      else ns.exit();
    }
  }
}
